<%- include('./partials/header') %>
<% if(success && success.length > 0){ %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-green-500 z-50">
        <span class="inline-block mt-1 mb-1 text-white">
            <%= success %>
        </span>
    </div>
<% } %>

<div class="w-full min-h-screen px-20 py-10">
    <h2 class="text-3xl font-semibold mb-8">My Orders</h2>
    
    <% if(!user.orders || user.orders.length === 0) { %>
        <div class="text-center py-20">
            <i class="ri-shopping-bag-3-line text-6xl text-gray-300"></i>
            <h3 class="text-2xl text-gray-500 mt-4">No orders yet</h3>
            <a href="/shop" class="inline-block mt-6 px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                Start Shopping
            </a>
        </div>
    <% } else { %>
        <div class="space-y-6">
            <% user.orders.reverse().forEach(function(order, index){ %>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-start mb-4 pb-4 border-b">
                        <div>
                            <h3 class="text-lg font-semibold">Order #<%= user.orders.length - index %></h3>
                            <p class="text-sm text-gray-600 mt-1">
                                Placed on <%= new Date(order.date).toLocaleDateString('en-IN', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric' 
                                }) %>
                            </p>
                            <% if(order.payment_id) { %>
                                <p class="text-xs text-gray-500 mt-1">Payment ID: <%= order.payment_id %></p>
                            <% } %>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Total Amount</p>
                            <p class="text-2xl font-bold text-green-600">₹ <%= order.total_amount ? order.total_amount.toFixed(2) : '0.00' %></p>
                            <span class="inline-block mt-2 px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full">
                                Completed
                            </span>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h4 class="font-semibold text-gray-700">Order Items:</h4>
                        <% if(order.products && order.products.length > 0) { %>
                            <% order.products.forEach(function(product){ %>
                                <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">
                                    <!-- Product Image -->
                                    <% if(product.image) { %>
                                        <div class="w-16 h-16 rounded bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0">
                                            <img class="h-14 w-14 object-cover" src="data:image/png;base64,<%= product.image %>" alt="<%= product.name || 'Product' %>">
                                        </div>
                                    <% } else { %>
                                        <div class="w-16 h-16 rounded bg-gray-300 flex items-center justify-center flex-shrink-0">
                                            <i class="ri-image-line text-2xl text-gray-500"></i>
                                        </div>
                                    <% } %>
                                    
                                    <!-- Product Details -->
                                    <div class="flex-grow">
                                        <p class="font-medium text-gray-900"><%= product.name || 'Unnamed Product' %></p>
                                        <p class="text-sm text-gray-600">
                                            ₹ <%= product.price ? product.price.toFixed(2) : '0.00' %>
                                        </p>
                                        <% if(product.discount && product.discount > 0) { %>
                                            <p class="text-xs text-red-600">Discount: ₹<%= product.discount.toFixed(2) %></p>
                                        <% } %>
                                    </div>
                                    
                                    <!-- Quantity -->
                                    <div class="text-right flex-shrink-0">
                                        <p class="text-sm text-gray-600">Qty: 1</p>
                                    </div>
                                </div>
                            <% }) %>
                        <% } else { %>
                            <p class="text-gray-500 text-center py-4">No products in this order</p>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } %>
</div>
<%- include('./partials/footer') %>